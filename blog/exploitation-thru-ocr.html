<style>
body {
    font-family: 'Roboto';font-size: 17px;
}
</style>

<html>
  <head>
  <meta charset="UTF-8">
  <meta name="description" content="Exploitation Thru OCR">
  <meta name="keywords" content="ahmethan gultekin">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
    <title>Ahmethan Gultekin - Exploitation Thru OCR</title>
  </head>
  <body>
   <center>
<div style="width:566px;">
    <img src = "https://upload.wikimedia.org/wikipedia/en/5/55/Bsd_daemon.jpg">
    <br>
      <h1>Exploitation Thru OCR (2019)</h1>
      <p>(Jekyll ile falan uğraşmaya üşendiğim için dümdüz yazıyorum. Gözünü kanattıklarımız kusurumuza bakmasın :] )<br><br>
Cümleten selamlar. Bu yazımda sizlere keşfetmiş olduğum değişik bir mevzudan bahsedeceğim. Bilerek mevzu diyorum çünkü tam olarak yeni bir açık değil.<br>
Not: Benden önce biri bu tarz bişeyler karaladı ise twitter adresimden ulaştırırsanız "keşfetmiş olduğum" ibaresini kaldırayım. Ben biraz araştırdım
          daha önce birinin bulduğuna dair bir şeye rast gelmedim.
<br><br></p>
  <h1>Nedir Bu OCR?</h1>
  <p>Türkçesi Optik Karakter Tanıma olan OCR herhangi bir belgenin , resimin istenilen dosya tipine dönüştürülmesini sağlayan bir teknolojidir.
    OCR, sizin verdiğiniz belgedeki görüntüleri işleyerek size yazı halinde bir çıktı veriyor.
    <br><br>Bu teknoloji güvenlikçilerin captcha bypass konusunda vazgeçilmezlerinden biri olsa da çeşitli yerlerde farklı görevler de görebiliyor.<br><br>
      OCR ' i locale kurup incelemek isteyenler için -> <a href = "https://github.com/thiagoalessio/tesseract-ocr-for-php">https://github.com/thiagoalessio/tesseract-ocr-for-php</a>
    </p><br><br>
    <h1>Exploitation Thru OCR</h1>
<p>Pentest aşamasında OCR tarafından okutulan veri nereye gidiyor tam olarak kestirmek mümkün olmayabilir. Ben localhostumdan atak senaryolarını anlatacağım.
Mantığını anladıktan sonra zaten pentest esnasında illa ki gözünüze çarpacaktır :)
<br><br>
Örneğin bir site var. Öğrenciler kitaplarını sayfa sayfa fotoğraf çekiyor. Siteye yüklediğinde sistem resimi yazıya çeviriyor. Yani basit bir OCR kullanımı :)
<br><br>
Şimdi düşünelim. Eğer ki kullanıcıdan aldığı resmi OCR ile okuttuktan sonra ekrana direk olarak bastırırsa XSS açığı meydana gelir. 
    Eğer ekrana bastırmadan direkt olarak bir dosya türüne çevirirse ve bu dosya türü .php , .html , .aspx gibi tehlikeli tiplerden ise 
    sisteme basitçe shell atıp erişebilirsiniz. Böyle anlatınca lafta kalıyor ama önce zihninizde canlandırıp sonra uygulamaya geçmek istedim :)
</p><br>
   <br>Yazıda adam zaten vermiş ama ben yine de kod bloğunu buraya koyayım.<br>
    <a href = "https://ahmeth4n.github.io/materials/ocr/form.txt"><h2>Form</h2></a>
    <a href = "https://ahmeth4n.github.io/materials/ocr/read.txt"><h2>PHP Okuma Kısmı</h2></a>
<br>
<br><a href = "https://ahmeth4n.github.io/img/ocr/1.png"><img src = "https://ahmeth4n.github.io/img/ocr/1.png" width = "500"></a>
    <br><br>
Basit olarak bu şekilde bir test lab hazırladım. Resimi yüklüyorsunuz arkaplanda işliyor ve size text olarak geri döndürüyor. Okuttuğum yazı;<br>
    <img src = "https://ahmeth4n.github.io/img/ocr/2.png"><br>
Çıktısı;<br>
<a href = "https://ahmeth4n.github.io/img/ocr/3.png"><img src = "https://ahmeth4n.github.io/img/ocr/3.png" width = "500"></a><br>
    <br>
Buraya kadar hiçbir sıkıntı yok gayet güzel çalışıyor. Peki ya biz buraya basit bir XSS payload'ı okutursak ne olur? Bi deneyelim.
<br><br>
Okutulan resim;<br>
    <a href = "https://ahmeth4n.github.io/img/ocr/4.png"><img src = "https://ahmeth4n.github.io/img/ocr/4.png"></a>
<br>
    Çıktı;<br>
<a href = "https://ahmeth4n.github.io/img/ocr/5.png"><img src = "https://ahmeth4n.github.io/img/ocr/5.png" width = "500"></a><br><br>
Bum :) Basit bir XSS atak senaryosu. <br><br>
Peki ya daha fazla ne yapılır? Bir oyun şirketi düşünün. Aktivasyon keyi için kendi hash tipleri olsun. Siz bu firmanın oyununu satın aldığınızda
    sitesine gidip o kısımı fotoğraf çekip okuttuğunuzda hesabınız aktif hale gelsin. Ama bu sefer <b>kullanıcıdan alınan key databasede sorgulansın acaba var mı yok mu diye :)</b> Örnek bir script yazarak onu da göstereyim.
<br><br>
Tekrar tekrar uğraşmayalım diye direk önceki form ekranını kullanıyorum sadece backend kısmında basit bir SQL Sorgusu ile okunan veriyi db'de kontrol ettireceğim.
<br><br>
    Form: <br>
<a href = "https://ahmeth4n.github.io/img/ocr/6.png"><img src = "https://ahmeth4n.github.io/img/ocr/6.png" width = "500"></a><br><br>
    <a href = "https://ahmeth4n.github.io/mysql.txt"><h1>BackEnd'i görmek için</h1></a>
<br>
    <h1>Okutulan resim ; </h1><br>
<img src = "https://ahmeth4n.github.io/img/ocr/7.png"><br>
<br>
    <h1>Çıktı;</h1><br>
    <a href = "https://ahmeth4n.github.io/img/ocr/8.png"><img src = "https://ahmeth4n.github.io/img/ocr/8.png" width = "500"></a><br><br>
Bu ve bunun gibi bir sürü atak çeşidi mevcut. Tek yapmanız gereken sistemde alınan veri nerede ve nasıl kontrol ediliyor iyi analiz etmek.
Ataklarını ona göre şekillendirir iseniz kesin sonuç elde edeceksinizdir :)<br><br>
Bu yazıda anlatacaklarım bu kadardı. Eğer ilgi görürse 2. serisinde daha gelişmiş atak senaryolarından bahsedeceğim. Başka bir yazıda görüşmek üzere,  hoşçakalın :)
    </div>
 <br><br>
      </center>
  </body>
</html>
