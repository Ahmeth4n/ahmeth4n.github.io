
<style>
body {
    font-family: 'Roboto';font-size: 17px;
}
</style>

<html>
  <head>
  <meta charset="UTF-8">
  <meta name="description" content="Wordpress Japanese AntiSEO Malware Writeup">
  <meta name="keywords" content="ahmethan gultekin">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
    <title>Ahmethan Gultekin / 90 kg developer!</title>
  </head>
  <body>
   <center>
<div style="width:566px;">
    <img src = "https://upload.wikimedia.org/wikipedia/en/5/55/Bsd_daemon.jpg">
    <br>
      <h1>Wordpress Japanese AntiSEO Web Malware Fixer</h1>
	  <img src = "https://secure.wphackedhelp.com/blog/wp-content/uploads/2018/02/Fix-Japanese-Keywords-Hack-In-Your-WordPress-Site.jpg" width = "300"> 
      <p>Herkese merhabalar. Uzun zaman oldu blog yazmayalı. Hem yazacak konu bulamayışımdan , hem de işlerden güçlerden vakit bulamamamdan dolayı aksattık biraz buraları.<br><br>
Geçen gün karşılaştığım ve ne yazık ki google'de tam anlamı ile çözümü bulunmayan bir malwarenin sistemini ve çözümü için yazdığım basit bir scriptten bahsedicem bugün sizlere.
<br><br>
Öncelikle biraz virüsün işlevinden bahsedeyim. Virüs sisteme bulaştığında URL Injection gerçekleştirerek google indexlerinizi manipüle ediyor.
Virüsün sisteme girdiğini googleye sitenizi site:siteadiniz.com şeklinde aratarak fark edebilirsiniz.<br><br>
<a href = "https://secure.wphackedhelp.com/blog/wp-content/uploads/2018/02/Wordpress-Japanese-Keyword-Hack-Search-3.png"><img src= "https://secure.wphackedhelp.com/blog/wp-content/uploads/2018/02/Wordpress-Japanese-Keyword-Hack-Search-3.png" width = "500"></a>
<br><br>
Virüs sisteme bulaştığı andan itibaren sizin sitemap dosyalarınızı manipüle ederek kendisine farklı bir dosyada bir sitemap oluşturuyor.
Oluşturduğu sitemap'leri robots.txt ' de arama motorlarının botlarına gerçek sitemap gibi gösterip indexlerinizi kendi ayarladığı indexler ile değiştiriyor.
<br><br>
İlk virüs ile karşılaştığımda acaba sisteme bulaştığında header.php ' ye kendi google verification kodunu ekleyip kendi google search console hesabına mı çekiyor siteyi
diye kontrol ettim , bir şey çıkmadı. Daha sonra herhangi bir javascript eklenmiş mi diye kontrol ettim yine bir sonuç çıkmadı.<br><br>
Daha sonra temp/ klasöründe yaklaşık 30-40 tane .xml dosyası gördüm. Bunlar virüsün kendi oluşturduğu dosyalardı. temp/ klasörünü silmeye çalıştığımdan
2 saniye sonra ise hemen tekrar kendini yeniliyordu.<br>
<br>
İlk başta tcpdump kurup temp/ klasörünü sildiğim an nereden nereye istek gidiyor bakmak geldi lakin daha kestirmeden halledeyim dedim.
access_log ' u temizledim ve temp/ klasörünü bir daha sildim. wp-config.php dosyasından wp-admin/images/test.png diye bir dosyaya post request atıldığını gördüm.
<br><br>
wp-config.php dosyasının içeriğini kontrol ettiğimde ise en baştaki satıra <pre>< ?php @require('wp-admin/images/test.png');?></pre> kodunun eklenmiş olduğunu gördüm.
Hemen ardından test.png dosyasını indirip açtığımda ise backdoor'un bu dosya olduğun anlamam çok sürmedi. <br><br>
Googleden araştırdığımda herkesin "cms sil tekrar kur , zararlı yazılımları" temizle gibi basit çözüm önerilerinde bulunduğunu gördüm. Ben de bir script yazayım , mevzu kökten hallolsun dedim.
<br> Aşağıda verdiğim scripti kullanarak virüsten tamamen kurtulabilirsiniz.
<img src = "http://resimag.com/p1/91856e81d34.png" width = "600"><br><br>
Github linki -> <a href = "https://github.com/Ahmeth4n/wp-antiseo-malware-fixer/blob/master/antiseo-malware-fixer.php">https://github.com/Ahmeth4n/wp-antiseo-malware-fixer/blob/master/antiseo-malware-fixer.php</a>
<br><br>
Başka bir blog yazısında görüşmek üzere , hoşçakalın :)
</p>
    </div>
	            <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://ahmeth4n.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<script id="dsq-count-scr" src="//ahmeth4n.disqus.com/count.js" async></script>
        </div>

<br>
       <a href="https://twitter.com/inject0r16?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @inject0r16</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

		<br><br>
      </center>
  </body>
</html>
